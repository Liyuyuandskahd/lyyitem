"use strict";!function(e){var j=document.getElementById(e.ele);j.innerHTML='<div class="head">\n                        <input type="checkbox" name="checkall" class="checkall">\n                        <span>全选</span>\n                        <span>商品信息</span>\n                        <span>本店价</span>\n                        <span>小计</span>\n                        <span>数量</span>\n                        <span>操作</span>\n                    </div>\n\n                    <div class="null">\n                        <div class="null-img"><img src="../images/xqy/cart_none.png" alt=""></div>\n                        <p>购物车空空如也~！</p>\n                    </div>\n                        \n                    <div class="main">\n                        \n                    </div>\n\n                    <div class="foot">\n                        <input type="checkbox" name="checkall" class="checkplus">\n                        <span>全选</span>\n                        <span class="delall">删除所选择的商品</span>\n                        <div class="prisum">\n                            <p>\n                                已选购商品<span class="selected">0</span>件\n                            </p>\n                            <p>\n                                总价：<span class="totalPrices">0.00</span>\n                            </p>\n                        </div>\n                        <input type="button" value="结 算" class="checkOut">\n                    </div>';var H=j.getElementsByClassName("main")[0],n=getCookie("uid");ajax({type:"get",url:"../api/showshopcar.php",data:{uid:n},success:function(e){var n=JSON.parse(e);!function h(d){var e=d.map(function(e){return'<ul class="shops">\n                            <li class="everyChecks">\n                                <input type="checkbox" name="checkall" class="checks"  data-index="'+e.uid+'">\n                            </li>\n\n                            <li class="headline">\n                                <i>\n                                    <img src="'+e.imgurl+'" alt="">\n                                </i>\n                                <p>'+e.name+'</p>\n                            </li>\n\n                            <li class="price">¥'+e.nowprice+'</li>\n\n                            <li class="sum">\n                                <span class="subtotal">¥'+e.nowprice+'</span>\n                            </li>\n\n                            <li class="number">\n                                <input type="button" value="-" class="cut">\n                                <input type="text" class="shuliang" value="'+e.buynum+'">\n                                <input type="button" value="+" class="add">\n                            </li>\n\n                            <li class="handle">\n                                <span class="del" data-id="'+e.uid+'">删除</span>\n                                <span>收藏</span>\n                            </li>\n                        </ul>'}).join("");H.innerHTML=e,j.getElementsByClassName("collect")[0];var n=j.getElementsByClassName("cut"),l=j.getElementsByClassName("shuliang"),a=j.getElementsByClassName("add"),c=j.getElementsByClassName("shops"),s=j.getElementsByClassName("null")[0];c.length?s.style.display="none":s.style.display="block";for(var t=function(t){function e(s){a[t].onclick=function(){var e=Number(l[t].value)+1,n=Number(s[t].uid);e<=s[t].inventory&&ajax({type:"get",url:"../api/changenumber.php",data:{sid:n,anum:e},success:function(e){}});var a=Number(s[t].inventory),c=this.parentNode.children[1].value;0<this.parentNode.children[1].value&&this.parentNode.children[1].value<a&&(c++,this.parentNode.children[1].value=c),b(),C(),x()},n[t].onclick=function(){var e=Number(l[t].value)-1,n=Number(s[t].uid);1<=e&&ajax({type:"get",url:"../api/changenumber.php",data:{sid:n,anum:e},success:function(e){}});var a=this.parentNode.children[1].value;1<this.parentNode.children[1].value&&(a--,this.parentNode.children[1].value=a),b(),C(),x()},l[t].onchange=function(){var e=Number(l[t].value),n=Number(s[t].uid);e<=1?e=1:e>=s[t].inventory&&(e=s[t].inventory),ajax({type:"get",url:"../api/changenumber.php",data:{sid:n,anum:e},success:function(e){}});var a=Number(s[t].inventory),c=this.parentNode.children[1].value;1<=c&&c<=a?this.parentNode.children[1].value=c:c<1?this.parentNode.children[1].value=1:a<c&&(this.parentNode.children[1].value=a),b(),C(),x()}}e(d)},i=0;i<n.length;i++)t(i);var r=j.getElementsByClassName("checkall")[0],u=j.getElementsByClassName("checkplus")[0],p=j.getElementsByClassName("checks"),o=j.getElementsByClassName("selected")[0],m=j.getElementsByClassName("totalPrices")[0],v=j.getElementsByClassName("del"),f=j.getElementsByClassName("subtotal"),c=j.getElementsByClassName("shops"),g=j.getElementsByClassName("delall")[0],k=j.getElementsByClassName("checkOut")[0],N=[];function y(){for(var e=0,n=!1,a=0;a<p.length;a++)p[a].checked&&e++,e==p.length&&(n=!0);return n}function b(){for(var e=0;e<f.length;e++)f[e].innerHTML="¥"+(d[e].nowprice*l[e].value).toFixed(2)}function x(){for(var e=0,n=0;n<p.length;n++)p[n].checked&&(e+=Number(l[n].value));o.innerHTML=e}function C(){for(var e=0,n=0;n<p.length;n++)if(p[n].checked){var a=Number(f[n].innerHTML.slice(1));e+=a}m.innerHTML=e.toFixed(2)}function B(){for(var e=0;e<p.length;e++)p[e].index=e,p[e].onclick=function(){if(r.checked=y(),u.checked=y(),p[this.index].checked)N.push(this.index),k.className="checkOut active";else{var e=N.indexOf(this.index);N.splice(e,1),k.className="checkOut"}x(),C()}}function E(){N.length?k.className="checkOut active":k.className="checkOut"}r.onclick=function(){for(var e=0;e<p.length;e++)p[e].checked=r.checked,r.checked?(N.push(e),k.className="checkOut active"):(N=[],k.className="checkOut");u.checked=r.checked,x(),C()},u.onclick=function(){for(var e=0;e<p.length;e++)p[e].checked=u.checked,u.checked?(N.push(e),k.className="checkOut active"):(N=[],k.className="checkOut");r.checked=u.checked,x(),C()},b(),B();for(var O=0;O<v.length;O++)v[O].onclick=function(){var e=confirm("确认要删除该商品么"),n=Number(this.dataset.id);if(e){ajax({type:"get",url:"../api/delshopcar.php",data:{uid:n},success:function(e){obj=JSON.parse(e)}}),H.removeChild(this.parentNode.parentNode),N=[];for(var a=0;a<p.length;a++)p[a].checked&&N.push(a);B(),r.checked=y(),u.checked=y(),E(),x(),C(),location.reload()}};g.onclick=function(){for(var e=0,n=0;n<p.length;n++)p[n].checked&&e++;if(e){var a=confirm("确认删除已选的商品吗？");if(a){N=N.sort(function(e,n){return n-e});for(var c=[],s=0;s<p.length;s++)if(p[s].checked){c.push(p[s].dataset.index);var t=!0,l=!1,i=void 0;try{for(var r,u=c[Symbol.iterator]();!(t=(r=u.next()).done);t=!0){var o=r.value;ajax({type:"get",url:"../api/delshopcar.php",data:{uid:Number(o)},success:function(e){obj=JSON.parse(e)}})}}catch(e){l=!0,i=e}finally{try{!t&&u.return&&u.return()}finally{if(l)throw i}}}location.reload(),h(d)}}else alert("请选择需要删除的商品")}}(n=n.reverse())}})}({ele:"shoppingcart"}),document.querySelector(".main-page").onclick=function(){location.href="../index.html"},document.querySelector(".list-page").onclick=function(){location.href="liebiaoye.html"};