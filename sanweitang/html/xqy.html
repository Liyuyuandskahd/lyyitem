<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>详情页</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/headerindex.css">
    <link rel="stylesheet" href="../css/xqy.css">
    <link rel="stylesheet" href="../css/swiper.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../iconfont/iconfont.css">
</head>

<body>
    <script src="../js/headerindex.js"></script>
    <script src="../js/magniglass.js"></script>
    <div class="current-position">
        <div class="content">
            <span>您的当前位置： 首页 — 品牌： 攀枝花市仁和区笮家食品经营部 —</span>
            <span class="shop-information">四川攀枝花 芒果干 60g/袋</span>
        </div>
    </div>
    <main>
        <div class="main-box1">
            <div class="content">

                <div class="img-box">
                    <div class="wrap" id="wrap">
                        <div class="biger">
                            <!-- <img src="" alt=""> -->
                        </div>
                        <div class="imgs">
                            <div class="main">
                                <!-- <img src="" alt=""> -->
                                <!-- <div class="mask" id="mask"></div> -->
                            </div>
                            <div class="bottom clearfix">
                                <p class="prev iconfont icon-shangyiye"></p>
                                <div class="box">
                                    <ul class="smaller">
                                        <!-- <li><img src="" alt=""></li> -->
                                    </ul>
                                </div>
                                <p class="next iconfont icon-xiayiye"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="shopdata-box">
                    <!-- <h3>四川攀枝花 芒果干 60g/袋</h3>
                    <div class="detail">
                        <p class="price-data">
                            <span>商城价</span>
                            <span>¥15.00</span>
                            <span>市场价</span>
                            <span>¥18.00</span>
                        </p>
                        <p class="promotion">
                            <span>促 销</span>
                            <span>满减</span>
                            <br>
                            <span>活动时间：2019-09-27 14:35:00 — 2019-12-31 14:34:00</span>
                            <br>
                            <span>买2袋减6元买三袋减19元</span>
                        </p>
                        <p class="delivery">
                            <span>配送服务</span>
                            <span>快递方式：商家自选快递，运费：免运费（ 注：收货地址地区不同，可能导致运费不同 ）</span>
                        </p>
                    </div>
                    <div class="volume">
                        <p>
                            <span class="iconfont icon-xiaoliang"></span>
                            <span>销量：0</span>
                        </p>
                        <p>
                            <span class="iconfont icon-pinglun"></span>
                            <span>评价：0</span>
                        </p>
                        <p>
                            <span class="iconfont icon-jifen"></span>
                            <span>赠送积分：15</span>
                        </p>
                    </div>
                    <div class="quantity">
                        <span>数 量</span>
                        <input type="button" value="-" id="cut">
                        <input type="text" id="shuliang">
                        <input type="button" value="+" id="add">
                        <span class="sheng">库存 6</span>
                    </div>
                    <div class="add-shoppingcart">
                        <input type="submit" value="立即购买" id="buying">
                        <input type="submit" value="加入购物车" id="addcart">
                        <span class="iconfont icon-shoucang11"></span>
                        <span>收藏</span>
                        <span class="iconfont icon-fenxiang1"></span>
                        <span>分享</span>
                    </div> -->
                </div>

                <div class="moreshops">
                    <h4>看了又看</h4>
                    <ul class="moreshops-box">
                        <!-- <li title="福建武夷 肉桂 160g*2防烟条">
                            <i><img src="../images/xqy/look1.jpg" alt=""></i>
                            <p>福建武夷 肉桂 160g*2防烟条</p>
                        </li>
                        <li title="山东沙沟 口口香辣脆 180g/瓶*2">
                            <i><img src="../images/xqy/look2.jpg" alt=""></i>
                            <p>山东沙沟 口口香辣脆 180g/瓶*2</p>
                        </li>
                        <li title="山东青岛 土鸡蛋 40枚/盒">
                            <i><img src="../images/xqy/look3.jpg" alt=""></i>
                            <p>山东青岛 土鸡蛋 40枚/盒</p>
                        </li>
                        <li title="好想你 枣恋 核桃夹心枣 218g/袋">
                            <i><img src="../images/xqy/look4.jpg" alt=""></i>
                            <p>好想你 枣恋 核桃夹心枣 218g/袋</p>
                        </li> -->
                    </ul>
                </div>
            </div>
        </div>

        <script src="../js/swiper.js"></script>

        <div class="main-box2">
            <div class="content">
                <div class="recommend">
                    <div class="swiper-container" id="recomd">
                        <div class="main-box2-head">
                            <h4>推荐商品</h4>
                        </div>
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg3.jpg" alt="">
                                </div>
                                <p>甘肃积石山 特级花椒 50...</p>
                                <p>
                                    <span>¥25.00</span>
                                    <s>¥30.72</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg3.jpg" alt="">
                                </div>
                                <p>甘肃积石山 特级花椒 50...</p>
                                <p>
                                    <span>¥25.00</span>
                                    <s>¥30.72</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg3.jpg" alt="">
                                </div>
                                <p>甘肃积石山 特级花椒 50...</p>
                                <p>
                                    <span>¥25.00</span>
                                    <s>¥30.72</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg1.jpg" alt="">
                                </div>
                                <p>黑龙江穆棱 百花蜜 500...</p>
                                <p>
                                    <span>¥38.00</span>
                                    <s>¥48.00</s>
                                </p>
                            </div>
                            <div class="swiper-slide">
                                <div class="swiper-box">
                                    <img src="../images/shouye/qg2.jpg" alt="">
                                </div>
                                <p>黑龙江 雪中王 香菇150...</p>
                                <p>
                                    <span>¥39.00</span>
                                    <s>¥64.32</s>
                                </p>
                            </div>
                        </div>
                        <!-- Add Pagination -->
                        <div class="swiper-pagination"></div>
                        <div class="swiper-button-next iconfont icon-xiayiye"></div>
                        <div class="swiper-button-prev iconfont icon-shangyiye"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-box3">
            <div class="content">
                <div class="main-box3-left">
                    <div class="shopname">
                        <h5>乌鲁木齐蔚蓝远景电子商务有限公司</h5>
                        <div class="shopname-content">
                            <i><img src="../images/xqy/shop_logo.png" alt=""></i>
                            <p>
                                商品： <span>19</span>&nbsp;&nbsp;已关注： <span>0</span>
                            </p>
                            <p>
                                宝贝描述： <span>5 高</span>
                            </p>
                            <p>
                                卖家服务： <span>5 高</span>
                            </p>
                            <p>
                                物流服务： <span>5 高</span>
                            </p>
                            <p>
                                <input type="button" value="进店逛逛">
                                <input type="button" value="收藏店铺">
                            </p>
                        </div>
                    </div>

                    <div class="hotsell">
                        <h5>热销推荐</h5>
                        <ul class="hotsell-shops">
                            <li title="四川攀枝花 芒果干60g/袋">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian1.jpg" alt="">
                                </div>
                                <p>四川攀枝花 芒果干60g/袋...</p>
                                <p>
                                    <span>¥15.00</span>
                                    <span>¥18.00</span>
                                </p>
                            </li>
                            <li title="新疆 火焰蜜哥哈密瓜 2个装（7-8斤）">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian2.jpg" alt="">
                                </div>
                                <p>新疆 火焰蜜哥哈密瓜 2个装...</p>
                                <p>
                                    <span>¥63.00</span>
                                    <span>¥75.60</span>
                                </p>
                            </li>
                            <li title="四川剑阁县 红将军苹果 10斤/箱">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian3.jpg" alt="">
                                </div>
                                <p>四川剑阁县 红将军苹果 10斤...</p>
                                <p>
                                    <span>¥78.00</span>
                                    <span>¥93.60</span>
                                </p>
                            </li>
                        </ul>
                    </div>

                    <div class="newproduct">
                        <h5>新品推荐</h5>
                        <ul class="hotsell-shops">
                            <li title="四川攀枝花 芒果干60g/袋">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian1.jpg" alt="">
                                </div>
                                <p>四川攀枝花 芒果干60g/袋...</p>
                                <p>
                                    <span>¥15.00</span>
                                    <span>¥18.00</span>
                                </p>
                            </li>
                            <li title="新疆 火焰蜜哥哈密瓜 2个装（7-8斤）">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian2.jpg" alt="">
                                </div>
                                <p>新疆 火焰蜜哥哈密瓜 2个装...</p>
                                <p>
                                    <span>¥63.00</span>
                                    <span>¥75.60</span>
                                </p>
                            </li>
                            <li title="四川剑阁县 红将军苹果 10斤/箱">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian3.jpg" alt="">
                                </div>
                                <p>四川剑阁县 红将军苹果 10斤...</p>
                                <p>
                                    <span>¥78.00</span>
                                    <span>¥93.60</span>
                                </p>
                            </li>
                            <li title="新疆吐鲁番 三色葡萄干220g/罐*2">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian4.jpg" alt="">
                                </div>
                                <p>新疆吐鲁番 三色葡萄干220g/...</p>
                                <p>
                                    <span>¥64.00</span>
                                    <span>¥76.80</span>
                                </p>
                            </li>
                            <li title="安徽黄山 毛峰（雨前三级）50g/罐*2">
                                <div class="rdshops-box">
                                    <img src="../images/shouye/tuijian5.jpg" alt="">
                                </div>
                                <p>安徽黄山 毛峰（雨前三级）...</p>
                                <p>
                                    <span>¥76.00</span>
                                    <span>¥91.20</span>
                                </p>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="main-box3-middle">
                    <div class="middle-head">
                        <input type="button" value="规格参数">
                        <input type="button" value="商品介绍">
                        <input type="button" value="商品评价（0）">
                        <input type="button" value="购物常见问题">
                    </div>

                    <div class="shops-item">
                        <p>
                            <span>商品名称：</span>
                            <span>新疆吐鲁番三色葡萄干220g/罐*2</span>
                            <span>商品编号：</span>
                            <span>swt000562</span>
                        </p>
                        <p>
                            <span>商品重量：</span>
                            <span>0.220</span>
                            <span>商品库存：</span>
                            <span>100</span>
                        </p>
                        <p>
                            <span>品牌：</span>
                            <span>乌鲁木齐蔚蓝远景电子商务有限公司</span>
                        </p>
                    </div>

                    <h5 class="module-name">商品介绍</h5>
                    <div class="shop-products">
                        <img src="../images/xqy/produ-1.jpg" alt="">
                    </div>

                    <h5 class="module-name">商品评价</h5>
                    <div class="shop-evaluate">
                        <p>
                            <span>0</span>
                            <span>好评度（0）</span>
                        </p>
                        <p>
                            <span class="iconfont icon-haoping"></span>
                            <span>好评 0%（0）</span>
                        </p>
                        <p>
                            <span class="iconfont icon-zhongping"></span>
                            <span>中评 0%（0）</span>
                        </p>
                        <p>
                            <span class="iconfont icon-chaping"></span>
                            <span>差评 0%（0）</span>
                        </p>
                    </div>
                    <div class="evaluate-main">
                        <div class="evaluate-box">
                            <em>
                                <img src="../images/xqy/null.png" alt="">
                            </em>
                            <p>暂时还没有任何评论！</p>
                        </div>
                        <div class="evaluate-box">
                            <em>
                                <img src="../images/xqy/null.png" alt="">
                            </em>
                            <p>暂时还没有任何评论！</p>
                        </div>
                        <div class="evaluate-box">
                            <em>
                                <img src="../images/xqy/null.png" alt="">
                            </em>
                            <p>暂时还没有任何评论！</p>
                        </div>
                        <div class="evaluate-box">
                            <em>
                                <img src="../images/xqy/null.png" alt="">
                            </em>
                            <p>暂时还没有任何评论！</p>
                        </div>
                    </div>

                    <h5 class="module-name">购物常见问题</h5>
                    <div class="question">
                        <p>一、下单后可以修改订单吗？</p>
                        <p>
                            由本网站发货的订单，在订单打印之前可以修改，打开“订单详情”页面，
                            点击右上角的“修改订单”即可，若没有修改订单按钮，则表示订单无法修改。</p>
                        <p>二、收到的商品少了/发错了怎么办？</p>
                        <p>
                            同个订单购买多个商品可能会分为一个以上包裹发出，可能不会同时送达，建议您耐心等待1-2天，
                            如未收到，本网站自营商品可直接联系在线客服，第三方商家商品请联系商家在线客服。</p>
                    </div>
                </div>

                <div class="main-box3-right">
                    <ul class="menubar">
                        <li>
                            规格参数
                            <span></span>
                        </li>
                        <li>
                            商品介绍
                            <span></span>
                        </li>
                        <li>
                            商品评价
                            <span></span>
                        </li>
                        <li>
                            购物常见问题
                            <span></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <div class="shade"></div>
    <div class="addwin">
        <div class="addwin-head">
            <span>信息</span>
            <span class="close">X</span>
        </div>
        <p>加入购物车成功</p>
        <p>
            <input type="button" value="购物车" class="skipcar">
            <input type="button" value="再看看" class="stroll">
        </p>
    </div>

    <script src="../js/footer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/jquery-1.10.1.min.js"></script>
    <script src="../js/headeraction.js"></script>
    <script src="../js/fixation.js"></script>
    <script>
        (function () {

            //遮罩
            let shade = document.querySelector('.shade');
            let addwin = document.querySelector('.addwin');
            let close = document.querySelector('.close');
            let skipcar = document.querySelector('.skipcar');
            let stroll = document.querySelector('.stroll');
            console.log($('html').css('height'));
            let iw = $('body').css('width');
            let ih = $('body').css('height');
            shade.style.width = window.innerWidth + 'px';
            shade.style.height = window.innerHeight + 'px';

            close.onclick = () => {
                addwin.style.display = 'none';
                shade.style.display = 'none';
            }
            stroll.onclick = () => {
                addwin.style.display = 'none';
                shade.style.display = 'none';
            }

            skipcar.onclick = () => {
                location.href = "shoppingcart.html";
                addwin.style.display = 'none';
                shade.style.display = 'none';
            }

            //数据渲染
            let shopdatabox = document.querySelector('.shopdata-box');
            let shopinformation = document.querySelector('.shop-information');
            let uid = location.search.slice(1);
            // console.log(uid);
            ajax({
                type: 'get',
                url: '../api/getshopdata.php',
                data: {
                    uid
                },
                success: function (res) {
                    vrey(res);
                }
            });

            function vrey(res) {
                let arr = JSON.parse(res);
                // console.log(arr);

                let html = `<h3>${arr[0].name}</h3>
                            <div class="detail">
                                <p class="price-data">
                                    <span>商城价</span>
                                    <span>¥${arr[0].nowprice}</span>
                                    <span>市场价</span>
                                    <span>¥${arr[0].originalprice}</span>
                                </p>
                                <p class="promotion">
                                    <span>促 销</span>
                                    <span>满减</span>
                                    <br>
                                    <span>活动时间：2019-09-27 14:35:00 — 2019-12-31 14:34:00</span>
                                    <br>
                                    <span>买2袋减6元买三袋减19元</span>
                                </p>
                                <p class="delivery">
                                    <span>配送服务</span>
                                    <span>快递方式：商家自选快递，运费：免运费（ 注：收货地址地区不同，可能导致运费不同 ）</span>
                                </p>
                            </div>
                            <div class="volume">
                                <p>
                                    <span class="iconfont icon-xiaoliang"></span>
                                    <span>销量：${arr[0].sell}</span>
                                </p>
                                <p>
                                    <span class="iconfont icon-pinglun"></span>
                                    <span>评价：${arr[0].comment}</span>
                                </p>
                                <p>
                                    <span class="iconfont icon-jifen"></span>
                                    <span>赠送积分：15</span>
                                </p>
                            </div>
                            <div class="quantity">
                                <span>数 量</span>
                                <input type="button" value="-" id="cut">
                                <input type="text" id="shuliang" value="1">
                                <input type="button" value="+" id="add">
                                <span class="sheng">库存 ${arr[0].inventory}</span>
                            </div>
                            <div class="add-shoppingcart">
                                <input type="submit" value="立即购买" id="buying">
                                <input type="submit" value="加入购物车" id="addcart">
                                <span class="iconfont icon-shoucang11"></span>
                                <span>收藏</span>
                                <span class="iconfont icon-fenxiang1"></span>
                                <span>分享</span>
                            </div>`;

                shopdatabox.innerHTML = html;
                shopinformation.innerHTML = arr[0].name;

                //大图切小图
                ajax({
                    type: 'get',
                    url: '../api/getimg.php',
                    data: {
                        uid
                    },
                    success: function (str) {
                        let arr2 = JSON.parse(str);
                        let arr3 = [];
                        for (let i = 0; i < arr2.length; i++) {
                            arr3[i] = arr2[i].imgurl;
                        }
                        // console.log(arr3);
                        magniglass({
                            ele: 'wrap',//最外层盒子的id(必填)
                            imglist: arr3,//图片数据(必填)
                            scal: 2,//大图放大倍数(选填，默认是2倍)
                            speed: 1//小图运动的图片个数(选填，默认是一次动一张图)
                        });
                    }
                });

                //选购商品数量
                var cut = document.getElementById('cut');
                var shuliang = document.getElementById('shuliang');
                var add = document.getElementById('add');
                var num = shuliang.value;
                cut.onclick = function () {

                    console.log(num);
                    if (num > 1) {
                        num--;
                    }
                    shuliang.value = num;
                }

                add.onclick = function () {

                    console.log(num);
                    if (num > 0 && num < arr[0].inventory) { //库存量为6
                        num++;
                    }
                    shuliang.value = num;
                }

                shuliang.onchange = () => {
                    let cont = shuliang.value;
                    if (cont < 1) {
                        shuliang.value = 1;
                    }
                    if (cont > arr[0].inventory) {
                        shuliang.value = arr[0].inventory;
                    }
                }

                //历史记录
                let moreshopsbox = document.querySelector('.moreshops-box');
                let eid = getCookie('uid');
                if (eid) {
                    ajax({
                        type: 'get',
                        url: '../api/history.php',
                        data: {
                            id: eid,//用户名id
                            uid: arr[0].id,//商品名id
                        },
                        success: str => {
                            // console.log(str);
                            showhistory(str);
                        }
                    });
                } else {
                    let html = `<li title="福建武夷 肉桂 160g*2防烟条">
                                    <i><img src="../images/xqy/look1.jpg" alt=""></i>
                                    <p>福建武夷 肉桂 160g*2防烟条</p>
                                </li>
                                <li title="山东沙沟 口口香辣脆 180g/瓶*2">
                                    <i><img src="../images/xqy/look2.jpg" alt=""></i>
                                    <p>山东沙沟 口口香辣脆 180g/瓶*2</p>
                                </li>
                                <li title="山东青岛 土鸡蛋 40枚/盒">
                                    <i><img src="../images/xqy/look3.jpg" alt=""></i>
                                    <p>山东青岛 土鸡蛋 40枚/盒</p>
                                </li>
                                <li title="好想你 枣恋 核桃夹心枣 218g/袋">
                                    <i><img src="../images/xqy/look4.jpg" alt=""></i>
                                    <p>好想你 枣恋 核桃夹心枣 218g/袋</p>
                                </li>`;
                    moreshopsbox.innerHTML = html;
                }

                function showhistory(str) {
                    let arr4 = JSON.parse(str);
                    arr4 = arr4.reverse();
                    if (arr4.length > 4) {
                        arr4.pop();
                    }
                    console.log(arr4);
                    let html = arr4.map(function (item) {
                        return `<li data-id="${item.uid}" title="${item.name}">
                                    <i><img src="${item.imgurl}" alt=""></i>
                                    <p>${item.name}</p>
                                </li>`;
                    }).join('');

                    moreshopsbox.innerHTML = html;
                    //点击历史记录商品跳转详情页
                    for (let i = 0; i < moreshopsbox.children.length; i++) {
                        console.log(moreshopsbox.children.length);
                        moreshopsbox.children[i].onclick = function () {
                            console.log(this.dataset.id);
                            let sid = this.dataset.id;
                            window.open('xqy.html?' + sid);
                        }
                    }
                }



                //加入购物车
                let addcart = document.querySelector('#addcart');
                addcart.onclick = () => {
                    let uesrid = getCookie('uid');
                    if (uesrid) {
                        // console.log(arr[0].id);
                        // console.log(uesrid);
                        ajax({
                            type: 'get',
                            url: '../api/checkshopcar.php',
                            data: {
                                cid: uesrid,//用户名id
                                uid: arr[0].id,//商品名id
                            },
                            success: res => {
                                addshops(res);
                            }
                        });
                    } else {
                        let skipurl = location.href;
                        setCookie('skipurl', skipurl, 7);
                        location.href = "denglu.html";
                    }

                    function addshops(res) {
                        let obj = JSON.parse(res);

                        if (obj.code) {
                            //购物车里没有该商品

                            let anum = shuliang.value;
                            // console.log(anum);
                            ajax({
                                type: 'get',
                                url: '../api/addshopcar.php',
                                data: {
                                    cid: uesrid,//用户名id
                                    uid: arr[0].id,//商品名id
                                    anum
                                },
                                success: str => {

                                    let obj2 = JSON.parse(str);
                                    console.log(obj2);
                                    if (obj2.code) {
                                        //成功加入购物车
                                        shade.style.display = 'block';
                                        addwin.style.display = 'block';
                                    } else {
                                        //加入购物车失败
                                        alert(obj2.message);
                                    }
                                }
                            });
                        } else {
                            //购物车里已存在该商品,购买数量累加

                            let pcs = Number(shuliang.value);
                            let bym = Number(obj.newarr[0].buynum);
                            let inv = Number(obj.newarr[0].inventory);
                            let sid = Number(obj.newarr[0].uid);
                            if ((pcs + bym) > inv) {
                                let anum = inv;
                                ajax({
                                    type: 'get',
                                    url: '../api/changenumber.php',
                                    data: {
                                        sid,
                                        anum
                                    },
                                    success: str => { }
                                });
                            } else {
                                let anum = (pcs + bym);
                                ajax({
                                    type: 'get',
                                    url: '../api/changenumber.php',
                                    data: {
                                        sid,
                                        anum
                                    },
                                    success: str => { }
                                });
                            }
                            shade.style.display = 'block';
                            addwin.style.display = 'block';
                        }
                    }
                }
            }

            //推荐商品
            var swiper = new Swiper('#recomd', {
                loop: true,
                slidesPerView: 5,
                slidesPerGroup: 5,
                spaceBetween: 0,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true
                }
            });

            //评论
            $('.shop-evaluate p').eq(0).attr('class', 'active');
            $('.shop-evaluate p').click(function () {
                $(this).attr('class', 'active').siblings().attr('class', '');
                $('.evaluate-main .evaluate-box').eq($(this).index()).css('display', 'block').siblings().css('display', 'none');
            });

            //吸顶菜单
            fixation('menubar');

            //楼层跳跃
            let menubar = document.querySelector('.menubar');
            let modulename = document.querySelectorAll('.module-name');
            let middlehead = document.querySelector('.middle-head');

            function exclude() {
                for (let k = 0; k < menubar.children.length; k++) {
                    menubar.children[k].children[0].style.display = 'none';
                }
            }

            for (let i = 0; i < menubar.children.length; i++) {
                menubar.children[i].onclick = function () {     //给每个楼层按钮设置点击事件
                    if (i == 0) {
                        let scrtop = middlehead.offsetTop;
                        exclude();  //排他
                        menubar.children[i].children[0].style.display = 'block';
                        window.scrollTo(0, scrtop);
                    }
                    else {
                        let scrtop = modulename[i - 1].offsetTop;    //点到哪层，就获取该楼层距离文档顶部的高度
                        exclude();  //排他
                        menubar.children[i].children[0].style.display = 'block';
                        window.scrollTo(0, scrtop);     //让可视窗口滚动到指定楼层
                    }
                }
            }

            menubar.children[0].className = 'altercss';
            menubar.children[0].children[0].style.display = 'block';
            bind(window, 'scroll', function () {  //事件监听
                var iTop = Math.ceil(window.scrollY);  //要向上取整，否则会出现小数点，定位按钮不准确
                if (iTop >= middlehead.offsetTop) {
                    for (var j = 0; j < menubar.children.length; j++) { //排他
                        menubar.children[j].className = '';
                    }
                    menubar.children[0].className = 'altercss';   //当可视窗口吧滚动到哪个模块时，对应的楼层按钮就会高亮
                    exclude();  //排他
                    menubar.children[0].children[0].style.display = 'block';
                }
                for (let i = 0; i < modulename.length; i++) {
                    if (iTop >= modulename[i].offsetTop) {
                        for (var j = 0; j < menubar.children.length; j++) { //排他
                            menubar.children[j].className = '';
                        }
                        menubar.children[i + 1].className = 'altercss';   //当可视窗口吧滚动到哪个模块时，对应的楼层按钮就会高亮
                        exclude();  //排他
                        menubar.children[i + 1].children[0].style.display = 'block';
                    }
                }
            });

            middlehead.children[0].className = 'variation';
            for (let i = 0; i < middlehead.children.length; i++) {
                middlehead.children[i].onclick = function () {     //给每个楼层按钮设置点击事件
                    if (i == 0) {
                        let scrtop = middlehead.offsetTop;
                        window.scrollTo(0, scrtop);
                        for (let j = 0; j < middlehead.children.length; j++) {
                            middlehead.children[j].className = '';
                        }
                        middlehead.children[0].className = 'variation';
                    }
                    else {
                        let scrtop = modulename[i - 1].offsetTop;    //点到哪层，就获取该楼层距离文档顶部的高度
                        window.scrollTo(0, scrtop);     //让可视窗口滚动到指定楼层
                        for (let j = 0; j < middlehead.children.length; j++) {
                            middlehead.children[j].className = '';
                        }
                        middlehead.children[i].className = 'variation';
                    }
                }
            }


        })();
    </script>
</body>

</html>