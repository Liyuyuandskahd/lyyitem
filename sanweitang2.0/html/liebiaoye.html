<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>列表页</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/headerindex.css">
    <link rel="stylesheet" href="../css/list.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../iconfont/iconfont.css">
</head>

<body>
    <script src="../js/headerlist.js"></script>
    <div class="current-position">
        <div class="content">
            <span>您的当前位置： 首页 &gt;</span>
            <span>商品列表</span>
        </div>
    </div>
    <main>
        <div class="content">
            <div class="main-left">
                <div class="main-left-head">
                    <h5>新品推荐</h5>
                </div>
                <ul class="main-left-content">
                    <li title="四川攀枝花 芒果干60g/袋">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian1.jpg" alt="">
                        </div>
                        <p>四川攀枝花 芒果干60g/袋...</p>
                        <p>
                            <span>¥15.00</span>
                            <span>¥18.00</span>
                        </p>
                    </li>
                    <li title="新疆 火焰蜜哥哈密瓜 2个装（7-8斤）">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian2.jpg" alt="">
                        </div>
                        <p>新疆 火焰蜜哥哈密瓜 2个装...</p>
                        <p>
                            <span>¥63.00</span>
                            <span>¥75.60</span>
                        </p>
                    </li>
                    <li title="四川剑阁县 红将军苹果 10斤/箱">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian3.jpg" alt="">
                        </div>
                        <p>四川剑阁县 红将军苹果 10斤...</p>
                        <p>
                            <span>¥78.00</span>
                            <span>¥93.60</span>
                        </p>
                    </li>
                    <li title="新疆吐鲁番 三色葡萄干220g/罐*2">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian4.jpg" alt="">
                        </div>
                        <p>新疆吐鲁番 三色葡萄干220g/...</p>
                        <p>
                            <span>¥64.00</span>
                            <span>¥76.80</span>
                        </p>
                    </li>
                    <li title="安徽黄山 毛峰（雨前三级）50g/罐*2">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian5.jpg" alt="">
                        </div>
                        <p>安徽黄山 毛峰（雨前三级）...</p>
                        <p>
                            <span>¥76.00</span>
                            <span>¥91.20</span>
                        </p>
                    </li>
                    <li title="福建平和 红肉柚 2个/箱">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian6.jpg" alt="">
                        </div>
                        <p>福建平和 红肉柚 2个/箱...</p>
                        <p>
                            <span>¥22.00</span>
                            <span>¥26.40</span>
                        </p>
                    </li>
                    <li title="云南文山三七粉 250g/罐">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian7.jpg" alt="">
                        </div>
                        <p>云南文山三七粉 250g/罐...</p>
                        <p>
                            <span>¥66.00</span>
                            <span>¥79.20</span>
                        </p>
                    </li>
                    <li title="安徽毫州 红豆薏米荧实茶 320g/袋">
                        <div class="rdshops-box">
                            <img src="../images/shouye/tuijian8.jpg" alt="">
                        </div>
                        <p>安徽毫州 红豆薏米荧实茶 32...</p>
                        <p>
                            <span>¥30.00</span>
                            <span>¥36.00</span>
                        </p>
                    </li>
                </ul>
            </div>
            <div class="main-right">
                <div class="main-right-head">
                    <div class="sort">
                        <p>
                            <span>综合</span>
                        </p>
                        <p class="price-rank">
                            <span>价格</span>
                            <span class="iconfont icon-jiangxu1"></span>
                        </p>
                        <p>
                            <span>新品</span>
                            <span class="iconfont icon-jiangxu1"></span>
                        </p>
                        <p class="price-sales">
                            <span>销量</span>
                            <span class="iconfont icon-jiangxu1"></span>
                        </p>
                    </div>
                    <div class="pagination">
                        <p>
                            共<span class="shopstotal"></span>个商品
                        </p>
                        <p>
                            <span class="iconfont icon-shangyiye"></span>
                            <span class="nowpage"></span> /
                            <span class="allpage"></span>
                            <span class="iconfont icon-xiayiye"></span>
                        </p>
                    </div>
                </div>
                <ul class="main-right-shoplist">
                    <!-- <li date-id="1" title="四川攀枝花 芒果干60g/袋...">
                        <div class="shoplist-box">
                            <img src="../images/shouye/tuijian1.jpg" alt="">
                        </div>
                        <p>四川攀枝花 芒果干60g/袋...</p>
                        <p>
                            <span>¥15.00</span>
                            <span>¥18.00</span>
                        </p>
                        <p>已售0件</p>
                        <p>
                            <span class="iconfont icon-shoucang11"></span>
                            <span>收藏</span>
                            <span class="iconfont icon-pinglun"></span>
                            <span>0</span>
                        </p>
                        <span class="boutique">精品</span>
                    </li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li> -->
                </ul>

                <div class="page">
                    <input type="button" value="首页" class="homepage">
                    <input type="button" value="上一页" class="prevpage">
                    <div class="pagenumber">
                        <div class="pagenumber-box">
                            <!-- <span>1</span>
                                <span>2</span> -->
                        </div>
                    </div>
                    <input type="button" value="下一页" class="nextpage">
                    <input type="button" value="尾页" class="traipage">
                    <p class="totalpage">共<span class="allpage"></span>页</p>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/footer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/jquery-1.10.1.min.js"></script>
    <script src="../js/headeraction.js"></script>
    <script src="../js/headrest.js"></script>
    <script>
        //排序
        // (function () {
        //     $('.sort p').each(function (index, item) {
        //         $(item).mouseenter(function () {
        //             $(this).find('span').eq(1).attr('class', 'iconfont icon-shengxu1');
        //         });
        //         $(item).mouseleave(function () {
        //             $(this).find('span').eq(1).attr('class', 'iconfont icon-jiangxu1');
        //         })
        //     });
        // })();

        //渲染数据
        (function () {
            let list = document.querySelector('.main-right-shoplist'); //列表页父元素节点
            let pagenumber = document.querySelector('.pagenumber');
            let inpage = document.querySelector('.pagenumber-box'); //页码父元素节点
            let pagination = document.querySelector('.pagination'); //页码父元素节点
            let scont = document.querySelector('.intext');//搜索框节点
            let sure = document.querySelector('.seek'); //搜索按钮节点
            let sort = document.querySelector('.sort'); //排序类型
            let pricerank = document.querySelector('.price-rank'); //价格排序
            let pagebox = document.querySelector('.page');
            let shopstotal = document.querySelector('.shopstotal');
            let nowpage = document.querySelector('.nowpage');
            let allpage = document.querySelectorAll('.allpage');
            let ipage = 1;  //页码
            let num = 16;    //每页的商品数量
            let keyword = '';   //用来装搜索内容
            let rank = '';  //排序
            let isok = false;

            function init() {
                ajax({
                    type: 'get',
                    url: '../api/getdata.php',
                    data: {
                        ipage,
                        num,
                        rank,
                        keyword
                    },
                    success: function (res) {
                        // console.log(res);
                        vray(res);
                    }
                });

                function vray(res) {
                    // console.log(res);
                    let arr = JSON.parse(res);
                    let html = arr.newarr.map(function (item) {
                        return `<li data-id=${item.id} title="${item.name}">
                                    <div class="shoplist-box">
                                        <img src="${item.imgurl}" alt="">
                                    </div>
                                    <p>${item.name}</p>
                                    <p>
                                        <span>¥${item.nowprice}</span>
                                        <span>¥${item.originalprice}</span>
                                    </p>
                                    <p>已售${item.sell}件</p>
                                    <p>
                                        <span class="iconfont icon-shoucang11"></span>
                                        <span>收藏</span>
                                        <span class="iconfont icon-pinglun"></span>
                                        <span>${item.comment}</span>
                                    </p>
                                    <span class="boutique">精品</span>
                                </li>`;
                    }).join('');
                    list.innerHTML = html;
                    shopstotal.innerHTML = arr.tatol;
                    nowpage.innerHTML = ipage;

                    let tol = Math.ceil(arr.tatol / num);   //页码数=商品楼总数/每页的商品数
                    for (let i = 0; i < allpage.length; i++) {
                        allpage[i].innerHTML = tol;
                    }
                    // console.log(arr.tatol);
                    let sth = '';
                    for (i = 0; i < tol; i++) {
                        sth += `<span>${i + 1}</span>`;
                    }
                    inpage.innerHTML = sth;
                    inpage.style.width = tol * inpage.children[0].offsetWidth + 10 * tol + 'px';//设置页码父元素的宽度
                    inpage.children[ipage - 1].classList.add('active'); //页码高亮

                    inpage.onclick = ev => {
                        if (ev.target.tagName == 'SPAN') {
                            ipage = ev.target.innerHTML;    //点击到哪个页码，就获取它的内容，赋值给当前页码数
                            window.scrollTo(0, 0);
                            init();
                        }
                    }

                    sure.onclick = () => {  //点击搜索时，将搜索内容传给后端
                        keyword = scont.value;
                        ipage = 1;
                        init();
                        scont.value = '';
                    }

                    pricerank.onclick = (ev) => {   //排序
                        console.log(ev.target.parentNode.children[0]);
                        for (let i = 0; i < ev.target.parentNode.children.length; i++) {
                            for (let j = 0; j < ev.target.parentNode.children[i].children.length; j++) {
                                ev.target.parentNode.children[i].children[j].style.color = '#666666';
                            }

                        }
                        for (let i = 0; i < ev.target.parentNode.parentNode.children.length; i++) {
                            for (let j = 0; j < ev.target.parentNode.parentNode.children[i].children.length; j++) {
                                ev.target.parentNode.parentNode.children[i].children[j].style.color = '#666666';
                            }

                        }

                        if (isok) {
                            rank = 'asc';
                            pricerank.children[1].className = 'iconfont icon-shengxu1';
                            pricerank.children[0].style.color = '#c01414';
                            pricerank.children[1].style.color = '#c01414';
                            isok = false;
                        } else {
                            rank = 'desc';
                            pricerank.children[1].className = 'iconfont icon-jiangxu1';
                            pricerank.children[0].style.color = '#c01414';
                            pricerank.children[1].style.color = '#c01414';
                            isok = true;
                        }

                        console.log(pricerank.children[1]);
                        ipage = 1;
                        init();

                    }

                    //上一页和下一页、首页和尾页

                    if (ipage == 1) {
                        pagebox.children[0].classList.add('showcss');
                        pagebox.children[1].classList.add('showcss');
                    } else {
                        pagebox.children[0].classList.remove('showcss');
                        pagebox.children[1].classList.remove('showcss');

                        pagebox.children[0].onmouseover = () => {
                            pagebox.children[0].classList.add('altercss');
                        }
                        pagebox.children[0].onmouseout = () => {
                            pagebox.children[0].classList.remove('altercss');
                        }
                        pagebox.children[1].onmouseover = () => {
                            pagebox.children[1].classList.add('altercss');
                        }
                        pagebox.children[1].onmouseout = () => {
                            pagebox.children[1].classList.remove('altercss');
                        }
                    }
                    if (ipage == inpage.children.length) {
                        pagebox.children[3].classList.add('showcss');
                        pagebox.children[4].classList.add('showcss');
                    } else {
                        pagebox.children[3].classList.remove('showcss');
                        pagebox.children[4].classList.remove('showcss');

                        pagebox.children[3].onmouseover = () => {
                            pagebox.children[3].classList.add('altercss');
                        }
                        pagebox.children[3].onmouseout = () => {
                            pagebox.children[3].classList.remove('altercss');
                        }
                        pagebox.children[4].onmouseover = () => {
                            pagebox.children[4].classList.add('altercss');
                        }
                        pagebox.children[4].onmouseout = () => {
                            pagebox.children[4].classList.remove('altercss');
                        }
                    }

                    pagination.onclick = (ev) => {
                        //上一页
                        if (ev.target.className == 'iconfont icon-shangyiye') {
                            if (ipage > 1) {
                                ipage--;
                                scrollTo(0, 0);
                                init();
                            }
                        }

                        //下一页
                        if (ev.target.className == 'iconfont icon-xiayiye') {
                            if (ipage < inpage.children.length) {
                                ipage++;
                                scrollTo(0, 0);
                                init();
                            }
                        }
                    }

                    pagebox.onclick = (ev) => {
                        //首页
                        if (ev.target.value == '首页') {
                            if (ipage != 1) {
                                ipage = 1;
                                scrollTo(0, 0);
                                init();
                            }
                        }

                        //上一页
                        if (ev.target.value == '上一页') {
                            if (ipage > 1) {
                                ipage--;
                                init();
                                scrollTo(0, 0);
                            }
                        }

                        //下一页
                        if (ev.target.value == '下一页') {
                            if (ipage < inpage.children.length) {
                                ipage++;
                                init();
                                scrollTo(0, 0);
                            }
                        }

                        //尾页
                        if (ev.target.value == '尾页') {
                            if (ipage != inpage.children.length) {
                                ipage = inpage.children.length;
                                init();
                                scrollTo(0, 0);
                            }
                        }

                        // console.log(ipage);
                    }

                    //跳转详情页
                    list.onclick = (ev) => {

                        if (ev.target.tagName == 'IMG') {
                            console.log(ev.target.parentNode.parentNode.dataset.id);
                            let sid = ev.target.parentNode.parentNode.dataset.id;
                            window.open('xqy.html?' + sid);
                        }
                    }

                    //跳转主页
                    let mainpage = document.querySelector('.main-page');
                    mainpage.onclick = () => {
                        location.href = '../index.html';
                    }

                    //跳转列表页
                    let listpage = document.querySelector('.list-page');
                    listpage.onclick = () => {
                        location.href = 'liebiaoye.html';
                    }

                }
            }


            init();
        })();

    </script>
</body>

</html>